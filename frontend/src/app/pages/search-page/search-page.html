<div class="search-container">
  <form (ngSubmit)="onSearch()">
    <div class="search-bar">
      <input type="text" [(ngModel)]="searchQuery" name="searchQuery"
        (ngModelChange)="filterAndSort()"
        placeholder="ğŸ” Buscar por tÃ­tulo, ubicaciÃ³n o especies..."
        class="search-input" />
      <button type="button" (click)="toggleAdvanced()" class="advanced-toggle"
        [class.active]="showAdvanced">
        {{ showAdvanced ? 'BÃºsqueda Simple' : 'BÃºsqueda Avanzada' }}
      </button>
    </div>

    @if (showAdvanced) {
      <div class="filters-section">
        <div class="filter-group">
          <label>Rango de fechas:</label>
          <input type="date" [(ngModel)]="filters.dateRange.start" name="dateStart" (ngModelChange)="filterAndSort()" />
          <input type="date" [(ngModel)]="filters.dateRange.end" name="dateEnd" (ngModelChange)="filterAndSort()" />
        </div>
        <div class="filter-group">
          <label>UbicaciÃ³n:</label>
          <input type="text" [(ngModel)]="filters.location.latitude" name="lat" placeholder="Latitud" (ngModelChange)="filterAndSort()" />
          <input type="text" [(ngModel)]="filters.location.longitude" name="lng" placeholder="Longitud" (ngModelChange)="filterAndSort()" />
        </div>
        <div class="filter-group">
          <label>HÃ¡bitat:</label>
          <input type="text" [(ngModel)]="filters.habitat" name="habitat" placeholder="Tipo de hÃ¡bitat..." (ngModelChange)="filterAndSort()" />
        </div>
        <div class="filter-group">
          <label>Clima:</label>
          <input type="text" [(ngModel)]="filters.climate" name="climate" placeholder="Condiciones climÃ¡ticas..." (ngModelChange)="filterAndSort()" />
        </div>
        <div class="filter-group">
          <label>Especies:</label>
          <input type="text" [(ngModel)]="filters.species" name="species" placeholder="Filtro por especie..." (ngModelChange)="filterAndSort()" />
        </div>
        <select [(ngModel)]="sortBy" name="sortBy" (ngModelChange)="filterAndSort()" class="sort-select">
          <option value="date">Ordenar por fecha</option>
          <option value="location">Ordenar por ubicaciÃ³n</option>
        </select>
      </div>
    }
  </form>

  <div class="results-container">
    @if (filteredResults().length === 0) {
      <div class="no-results">
        <p>ğŸ” No se encontraron resultados</p>
      </div>
    } @else {
      @for (task of filteredResults(); track task._id) {
        <a [routerLink]="['/details', task._id]" class="result-card">
          <h3>ğŸ“ {{ task.title }}</h3>
          <p>ğŸ“… Fecha: {{ task.samplingDateTime | date:'mediumDate' }}</p>
          <p>ğŸ“ UbicaciÃ³n: {{ task.location.latitude }}, {{ task.location.longitude }}</p>
          <p>ğŸŒ¿ Especies: {{ task.speciesDetails.length }}</p>
          <p>ğŸï¸ HÃ¡bitat: {{ task.habitatDescription }}</p>
          <p>ğŸŒ¤ï¸ Clima: {{ task.weatherConditions }}</p>
        </a>
      }
    }
  </div>
</div>
